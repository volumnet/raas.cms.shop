!function(t){var e={};function a(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=e,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(s,r,function(e){return t[e]}.bind(null,r));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=12)}([function(t,e,a){},function(t,e,a){},function(t,e,a){},function(t,e,a){},function(t,e,a){},function(t,e,a){},function(t,e,a){"use strict";a(0)},function(t,e,a){"use strict";a(1)},function(t,e,a){"use strict";a(2)},function(t,e,a){"use strict";a(3)},function(t,e,a){"use strict";a(4)},function(t,e,a){"use strict";a(5)},function(t,e,a){"use strict";a.r(e);var s={props:{step:{type:Number,default:0}},methods:{getStepHref(t){let e=window.location.search;return e=e.replace(/(\?|&)step=\w+/gi,""),t&&(e+=(e?"&":"?")+"step="+t),e}}};a(6);function r(t,e,a,s,r,l,n,i){var o,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=a,c._compiled=!0),s&&(c.functional=!0),l&&(c._scopeId="data-v-"+l),n?(o=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},c._ssrRegister=o):r&&(o=i?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),o)if(c.functional){c._injectStyles=o;var u=c.render;c.render=function(t,e){return o.call(e),u(t,e)}}else{var p=c.beforeCreate;c.beforeCreate=p?[].concat(p,o):[o]}return{exports:t,options:c}}var l=r(s,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("nav",{staticClass:"priceloader-steps"},[a("ul",{staticClass:"priceloader-steps__list"},t._l(["UPLOAD","MATCHING","APPLY","DONE"],(function(e,s){return a("li",{staticClass:"priceloader-steps__item",class:{"priceloader-steps__item_proceed":t.step>s,"priceloader-steps__item_active":t.step==s}},[a(t.step>s&&t.step<3?"a":"span",{tag:"component",staticClass:"priceloader-steps__link",attrs:{href:t.getStepHref(s)}},[t._v("\n        "+t._s(t.$root.translations["PRICELOADER_STEP_"+e])+"\n      ")])],1)})),0)])}),[],!1,null,"038069e3",null).exports,n={methods:{inputMask:function(t={}){let e=Object.assign({showMaskOnFocus:!1,showMaskOnHover:!0},t),a=$(this.$el).add($("input",this.$el));a.filter("[pattern]:not([data-inputmask-pattern]):not([data-no-inputmask])").each((function(){var t=$(this).attr("pattern");$(this).attr("data-inputmask-pattern",t).attr("autocomplete","off").inputmask(Object.assign({regex:t},e))})),a.filter('[type="tel"]:not([pattern]):not([data-inputmask-pattern]):not([data-no-inputmask])').attr("data-inputmask-pattern","+9 (999) 999-99-99").attr("autocomplete","off").inputmask("+9 (999) 999-99-99",e),a.filter('[data-type="email"]:not([pattern]):not([data-inputmask-pattern]):not([data-no-inputmask])').attr("data-inputmask-pattern","*{+}@*{+}.*{+}").attr("autocomplete","off").inputmask("*{+}@*{+}.*{+}",e)},applyInputMaskListeners:function(){let t=this;$(this.$el).add($("input",this.$el)).filter("[data-inputmask-pattern]:not([data-inputmask-events])").on("input",(function(e){t.pValue=e.target.value,t.$emit("input",e.target.value)})).on("change",(function(e){t.pValue=e.target.value,t.$emit("change",e.target.value)})).on("keydown",(function(e){t.pValue=e.target.value,t.$emit("input",e.target.value)})).attr("data-inputmask-events","true")}}},i={mixins:[{mixins:[{props:{type:{type:[String,Object],default:"text"},value:{},source:{}},mixins:[n],inheritAttrs:!1,data(){return{pValue:this.value}},mounted(){this.inputMask(),this.applyInputMaskListeners()},updated(){this.inputMask(),this.applyInputMaskListeners()},methods:{setPValue(t){this.pValue=t},getFlatSource:function(t,e=0){let a=[];for(let s of t){let t={value:s.value,name:s.name||s.caption,level:e};s.disabled&&(t.disabled=!0),a.push(t),s.children&&(a=a.concat(this.getFlatSource(s.children,e+1)))}return a}},computed:{resolvedAttrs(){let t=this.$attrs;return"object"==typeof this.type&&(t.is="raas-field-"+(this.type.datatype||"text"),this.type.datatype&&(t.type=this.type.datatype),this.type.urn&&(t.name=this.type.urn),this.type.htmlId&&(t.id=this.type.htmlId),this.type.stdSource&&(t.source=this.type.stdSource),this.type.accept&&(t.accept=this.type.accept),this.type.pattern&&(t.pattern=this.type.pattern),this.type.class&&(t.class=Object.assign({},t.class||{},this.type.class)),this.type.className&&(t.class=Object.assign({},t.class||{},this.type.className)),-1!=["number","range"].indexOf(this.type.datatype)&&(this.type.min_val&&(t.min=this.type.min_val),this.type.max_val&&(t.max=this.type.max_val),this.type.step&&(t.step=this.type.step)),this.type.defval&&-1!=["checkbox","radio"].indexOf(this.type.datatype)&&(t.defval=this.type.defval),this.type.required&&(t.required=!0),this.type.multiple&&-1==["radio"].indexOf(this.type.datatype)&&(t.multiple=!0),this.type.placeholder&&(t.placeholder=this.type.placeholder),this.type.maxlength&&(t.maxlength=this.type.maxlength)),t.type||(t.type="text"),t},flatSource(){let t=this.source;return t instanceof Array||(t=[]),this.getFlatSource(t)},currentComponent(){return"raas-field-"+(this.type||"text")},inputListeners(){return Object.assign({},this.$listeners,{input:t=>{this.pValue=$(t.target).val(),this.$emit("input",$(t.target).val())}})},multilevel(){return this.flatSource.filter(t=>t.level>0).length>0}},watch:{value(t,e){JSON.stringify(t)!=JSON.stringify(e)&&(this.pValue=this.value)}}}],props:{placeholder:{type:String},accept:{type:String}},data:()=>({fileName:null,dragOver:!1}),methods:{changeFile(t){let e=(t.target||window.event.srcElement).files;if(e&&e.length){this.fileName=e[0].name;let t=this.fileName.split("."),a=t.length>1?t[t.length-1]:"",s=e[0].type;this.allowedTypes&&this.allowedTypes.length&&-1==this.allowedTypes.indexOf(a)&&-1==this.allowedTypes.indexOf(s)?(this.fileName="",this.$refs.input.value="",this.$emit("input","")):this.$emit("input",this.fileName)}else this.fileName="",this.$refs.input.value="",this.$emit("input","")},clearFile(){this.fileName="",this.$refs.input.value="",this.$emit("input","")},chooseFile(){this.$refs.input.click()},handleDrop(t){}},computed:{allowedTypes(){if(!this.accept)return null;let t=this.accept.split(",");return t=t.map(t=>t.replace(".","")).filter(t=>!!t),t},iconCSSClass(){let t={};if(this.fileName){let e=/\.(\w+)\s*$/;if(e.test(this.fileName)){t["raas-field-file__icon_"+e.exec(this.fileName)[1].toLowerCase()]=!0}}return t}}}],methods:{handleDrop(t){const e=t.dataTransfer.files;this.$refs.input.files=e,this.changeFile({target:{files:e}})}}},o=(a(7),r(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{staticClass:"priceloader-file-field",class:{"priceloader-file-field_drag":t.dragOver},on:{dragover:function(e){e.preventDefault(),t.dragOver=!0},dragleave:function(e){t.dragOver=!1},drop:function(e){e.preventDefault(),t.handleDrop(e),t.dragOver=!1}}},[a("input",t._g(t._b({ref:"input",staticClass:"priceloader-file-field__input",attrs:{type:"file",accept:t.accept},on:{change:function(e){return t.changeFile(e)}}},"input",t.$attrs,!1),t.inputListeners)),t._v(" "),a("raas-icon",{attrs:{icon:"file-excel-o"}}),t._v(" "),t.fileName?[t._v("\n      "+t._s(t.fileName)+"\n    ")]:[t._v("\n      "+t._s(t.$root.translations.PLEASE_CHOOSE_OR_DRAG_PRICE_FILE)+"\n    ")]],2)}),[],!1,null,"d23d8c0c",null).exports),c={props:{loader:{type:Object,default:()=>({})},loaderData:{type:Object,default:()=>({})}},data(){const t={rows:this.loaderData.startRow,rowsSortCounter:0,columns:[]};for(let e=0;e<this.loaderData.columns.length;e++)t.columns.push(this.loaderData.columns[e].columnId);return t},mounted(){let t=null;$("tbody",this.$el).sortable({axis:"y",cancel:"tr:not(.priceloader-table__rows-separator)",containment:"parent",start:(e,a)=>{t=a.item.parent().children().index(a.item)},stop:(e,a)=>{let s=a.item.parent().children().index(a.item);s!=t&&(this.rows=s,window.setTimeout(()=>{this.rowsSortCounter++})),t=null}})},methods:{getLetter(t){let e="",a=t+1;do{const t=(a-1)%26;e=String.fromCharCode(t+65)+e,a=Math.floor((a-t-1)/26)}while(a>0);return e},getLoaderColumn(t){let e=this.columns[t],a=null;return e&&this.loader.columns[e+""]&&(a=this.loader.columns[e+""]),a},isUniqueColumn(t){let e=this.getLoaderColumn(t);return e&&this.loader.ufid==e.fid},getColumnsSource(t){const e=[],a=Object.values(this.loader.columns);for(let t=0;t<a.length;t++){let s=a[t];e.push({value:s.id,caption:s.name})}return e},setColumnIndex(t,e){parseInt(e);const a=[];for(let s=0;s<this.columns.length;s++)s==t?a.push(e):this.columns[s]==e?a.push(null):a.push(this.columns[s]);this.columns=a}}},u=(a(8),r(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("table",{staticClass:"priceloader-table",style:{"--columns":t.loaderData.columns.length}},[a("thead",[a("tr",{staticClass:"priceloader-table__letters-row"},[a("th"),t._v(" "),t._l(t.loaderData.columns,(function(e,s){return a("th",[t._v("\n        "+t._s(t.getLetter(s))+"\n      ")])}))],2),t._v(" "),a("tr",{staticClass:"priceloader-table__columns-row"},[a("th",[a("input",{attrs:{type:"hidden",name:"rows"},domProps:{value:t.rows}})]),t._v(" "),t._l(t.loaderData.columns,(function(e,s){return a("th",{staticClass:"priceloader-table__field",class:{"priceloader-table__field_unique":t.isUniqueColumn(s)}},[a("raas-field-select",{attrs:{name:"columns[]",source:t.getColumnsSource(s),placeholder:"--",value:t.columns[s]},on:{input:function(e){return t.setColumnIndex(s,e)}}}),t._v(" "),t.isUniqueColumn(s)?a("div",{staticClass:"priceloader-table__unique-label"},[t._v(t._s(t.$root.translations.UNIQUE))]):t._e()],1)}))],2)]),t._v(" "),a("tbody",[t._l(t.loaderData.rows,(function(e,s){return[s==t.rows?a("tr",{staticClass:"priceloader-table__rows-separator"},[a("td",{attrs:{colspan:t.loaderData.columns.length+1}})]):t._e(),t._v(" "),a("tr",{key:s+"_"+t.rowsSortCounter,staticClass:"priceloader-table__row",class:{"priceloader-table__row_inactive":s<t.rows,"priceloader-table__row_page":1==e.cells.map((function(t){return t.rawValue.trim()})).filter((function(t){return""!==t})).length}},[a("th",{on:{click:function(e){t.rows=s}}},[t._v(t._s(parseInt(s)+1))]),t._v(" "),t._l(t.loaderData.columns,(function(s,r){return a("td",{staticClass:"priceloader-table__cell",class:{"priceloader-table__cell_inactive":!t.columns[r]}},[t._v(t._s(e.cells[r]?e.cells[r].rawValue:""))])}))],2)]})),t._v(" "),t.rows==t.loaderData.rows.length?a("tr",{staticClass:"priceloader-table__rows-separator"},[a("td",{attrs:{colspan:t.loaderData.columns.length+1}})]):t._e()],2),t._v(" "),t.loader.totalRows>t.loaderData.rows.length?a("tfoot",[a("tr",{staticClass:"priceloader-table__total-rows"},[a("th"),t._v(" "),a("th",{attrs:{colspan:t.loaderData.columns.length}},[t._v("\n        "+t._s(t.$root.translations.TOTAL_ROWS)+": "+t._s(t.loader.totalRows)+"\n      ")])])]):t._e()])}),[],!1,null,"4782e0de",null).exports),p={props:{loader:{type:Object,default:()=>({})},loaderData:{type:Object,default:()=>({})}},methods:{getLoaderColumn(t){let e=this.columns[t],a=null;return e&&this.loader.columns[e+""]&&(a=this.loader.columns[e+""]),a},isUniqueColumn(t){let e=this.getLoaderColumn(t);return e&&this.loader.ufid==e.fid}},computed:{columns(){const t=[];for(let e=0;e<this.loaderData.columns.length;e++){const a=this.loaderData.columns[e].columnId;if(a&&this.loader.columns[a+""]){const s={...this.loader.columns[a+""]};s.index=e,s.unique=this.loader.ufid==s.fid,t.push(s)}}return t}}},d=(a(9),{components:{"priceloader-file-field":o,"priceloader-table":u,"priceloader-result-table":r(p,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("table",{staticClass:"priceloader-result-table",style:{"--columns":t.loaderData.columns.length}},[a("thead",[a("tr",{staticClass:"priceloader-result-table__columns-row"},[a("th"),t._v(" "),a("th",[t._v("\n        "+t._s(t.$root.translations.PAGE_MATERIAL)+"\n      ")]),t._v(" "),t._l(t.columns,(function(e){return a("th",{staticClass:"priceloader-result-table__field",class:{"priceloader-result-table__field_unique":e.unique}},[a("div",[t._v(t._s(e.name))]),t._v(" "),e.unique?a("div",{staticClass:"priceloader-result-table__unique-label"},[t._v(t._s(t.$root.translations.UNIQUE))]):t._e()])}))],2)]),t._v(" "),a("tbody",[t._l(t.loaderData.rows,(function(e,s){return[e.type&&e.entity&&e.entity.length?t._l(e.entity,(function(r){return a("tr",{staticClass:"priceloader-result-table__row"},[a("th",[t._v(t._s(parseInt(s)+1))]),t._v(" "),a("th",{staticClass:"priceloader-result-table__entity",class:{"priceloader-result-table__entity_page":"page"==e.type},style:{"--level":r.level},attrs:{colspan:"page"==e.type?t.columns.length+1:1}},[a(isNaN(r.id)?"span":"a",{tag:"component",attrs:{href:isNaN(r.id)?null:"?p=cms"+("material"==e.type?"&action=edit_material":"")+"&id="+r.id,title:t.$root.translations["PRICELOADER_LEGEND_"+(e.type+"_"+e.action+("e"==e.action.substr(-1)?"d":"ed")).toUpperCase()],target:"_blank"}},["select"==e.action?a("raas-icon",{staticClass:"text-primary",attrs:{icon:"folder-open"}}):"create"==e.action?a("raas-icon",{staticClass:"text-success",attrs:{icon:"plus"}}):"update"==e.action?a("raas-icon",{staticClass:"text-warning",attrs:{icon:"pencil"}}):t._e(),t._v("\n              "+t._s(r.name)+"\n            ")],1)],1),t._v(" "),"page"!=e.type?t._l(t.columns,(function(s){return a("td",{staticClass:"priceloader-result-table__cell"},[t._v("\n              "+t._s(e.cells[s.index]?e.cells[s.index].value:"")+"\n            ")])})):t._e()],2)})):t._e()]}))],2)])}),[],!1,null,"45493b08",null).exports},props:{loader:{type:Object,default:()=>({})},step:{type:Number,default:0},loaderData:{type:Object,default:()=>({})}},data:()=>({}),mounted(){},methods:{getStepHref(t){let e=window.location.search;return e=e.replace(/(\?|&)step=\w+/gi,""),t&&(e+=(e?"&":"?")+"step="+t),e}},computed:{prevHref(t){return this.getStepHref(this.step-1)}}}),_=(a(10),{components:{"priceloader-steps":l,"priceloader-form":r(d,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("form",{staticClass:"priceloader-form form-horizontal",attrs:{action:"",method:"post",enctype:"multipart/form-data"}},[a("div",{staticClass:"priceloader-form__inner"},[1==t.step?[a("div",{staticClass:"alert alert-warning"},[a("p",[a("raas-icon",{attrs:{icon:"exclamation-triangle"}}),t._v(" "),a("strong",[t._v(t._s(t.$root.translations.PRICELOADER_STEP_MATCHING_HINT_HEADER))])],1),t._v(" "),a("div",{domProps:{innerHTML:t._s(t.$root.translations.PRICELOADER_STEP_MATCHING_HINT)}})]),t._v(" "),a("div",{staticClass:"control-group"},[a("label",{staticClass:"control-label",attrs:{for:"cat_id"}},[t._v("\n          "+t._s(t.$root.translations.CATEGORY)+":\n        ")]),t._v(" "),a("div",{staticClass:"controls"},[a("raas-field-select",{staticClass:"span5",attrs:{name:"cat_id",source:t.loader.fields.cat_id.source,value:t.loaderData.rootCategoryId,required:!0}})],1)]),t._v(" "),a("div",{staticClass:"priceloader-form__table"},[a("priceloader-table",{attrs:{loader:t.loader,"loader-data":t.loaderData}})],1)]:2==t.step?[a("div",{staticClass:"alert alert-warning"},[a("raas-icon",{attrs:{icon:"exclamation-triangle"}}),t._v(" "),a("strong",[t._v(t._s(t.$root.translations.PRICELOADER_STEP_APPLY_HINT))])],1),t._v(" "),a("div",{staticClass:"priceloader-form__table"},[a("priceloader-result-table",{attrs:{loader:t.loader,"loader-data":t.loaderData}})],1)]:3==t.step?[a("div",{staticClass:"alert alert-success"},[a("raas-icon",{attrs:{icon:"check-circle"}}),t._v(" "),a("strong",[t._v(t._s(t.$root.translations.PRICE_SUCCESSFULLY_UPLOADED))])],1),t._v(" "),a("h2",[t._v(t._s(t.$root.translations.UPLOAD_RESULTS))]),t._v(" "),a("div",{staticClass:"priceloader-form__table"},[a("priceloader-result-table",{attrs:{loader:t.loader,"loader-data":t.loaderData}})],1)]:[a("div",{staticClass:"alert alert-warning"},[a("raas-icon",{attrs:{icon:"exclamation-triangle"}}),t._v(" "),a("strong",{domProps:{innerHTML:t._s(t.$root.translations.PRICELOADER_STEP_UPLOAD_HINT)}})],1),t._v(" "),a("div",{staticClass:"priceloader-form__file"},[a("priceloader-file-field",{attrs:{accept:".xls,.xlsx,.csv",name:"file"}})],1)]],2),t._v(" "),a("div",{staticClass:"priceloader-form__controls"},[t.step>0&&t.step<3?a("a",{staticClass:"btn btn-large",attrs:{href:t.prevHref}},[t._v("« "+t._s(t.$root.translations.BACK))]):t._e(),t._v(" "),2==t.step?a("button",{staticClass:"btn btn-large btn-warning",attrs:{type:"submit",onclick:"return confirm('"+t.$root.translations.PRICELOADER_APPLY_CONFIRM+"')"}},[a("raas-icon",{attrs:{icon:"check-circle"}}),t._v("\n      "+t._s(t.$root.translations.APPLY)+"\n    ")],1):3==t.step?a("a",{staticClass:"btn btn-large btn-success",attrs:{href:t.getStepHref(0)}},[a("raas-icon",{attrs:{icon:"check-circle"}}),t._v("\n      "+t._s(t.$root.translations.PRICELOADER_STEP_DONE)+"\n    ")],1):a("button",{staticClass:"btn btn-large btn-success",class:{"btn-success":t.step>=4,"btn-primary":t.step<4},attrs:{type:"submit"}},[t._v("\n      "+t._s(t.$root.translations.GO_NEXT)+" »\n    ")])])])}),[],!1,null,"58b2dca6",null).exports},props:{loader:{type:Object,default:()=>({})},step:{type:Number,default:0},loaderData:{type:Object,default:()=>({})}},data:()=>({}),mounted(){},methods:{},computed:{self(){return{...this}}}}),h=(a(11),{"cms-shop-priceloader":r(_,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"priceloader"},[e("priceloader-steps",{staticClass:"priceloader__steps",attrs:{step:this.step}}),this._v(" "),e("priceloader-form",{staticClass:"priceloader__form",attrs:{loader:this.loader,step:this.step,"loader-data":this.loaderData}})],1)}),[],!1,null,"561e7ffe",null).exports});window.raasComponents=Object.assign({},window.raasComponents,h)}]);